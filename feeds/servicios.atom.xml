<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Blog Informático - Servicios</title><link href="https://arpovea.vercel.app/" rel="alternate"></link><link href="https://arpovea.vercel.app/feeds/servicios.atom.xml" rel="self"></link><id>https://arpovea.vercel.app/</id><updated>2020-11-05T00:00:00+01:00</updated><entry><title>Servidor web NGINX</title><link href="https://arpovea.vercel.app/servidor-web-nginx.html" rel="alternate"></link><published>2020-11-05T00:00:00+01:00</published><updated>2020-11-05T00:00:00+01:00</updated><author><name>Adrián Rodríguez Povea</name></author><id>tag:arpovea.vercel.app,2020-11-05:/servidor-web-nginx.html</id><summary type="html">&lt;p&gt;Buenas! En esta ocasión se va a realizar un conjunto de tareas con el servidor web Nginx.&lt;/p&gt;</summary><content type="html">&lt;hr&gt;
&lt;p&gt;Buenas, en esta ocasión se va a realizar un conjunto de tareas con el servidor web Nginx, desde crear varios "virtual host" hasta jugar con el control de acceso y autorización. Para este escenario se utilizará S.O Debian Buster.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Creación de los Virtual Host:&lt;/h2&gt;
&lt;p&gt;Este servidor tendrá dos sitios web, cada sitio web compartirá la misma dirección y el mismo puerto (80), estos sitios tendrán las siguientes características:&lt;/p&gt;
&lt;p&gt;El nombre de dominio del primero será "www.iesgn.org", su directorio base será "/srv/www/iesgn" y contendrá una página llamada index.html, donde solo se verá una "bienvenida" a la página del Instituto Gonzalo Nazareno.&lt;/p&gt;
&lt;p&gt;En el segundo sitio, se va a crear una página, donde se pondrán noticias por parte de los departamentos, el nombre de este sitio será departamentos.iesgn.org, y su directorio base será "/srv/www/departamentos". En este sitio solo habrá una página inicial index.html, dando la bienvenida a la página de los departamentos del instituto.&lt;/p&gt;
&lt;h3&gt;Configuración de "www.iesgn.org"&lt;/h3&gt;
&lt;p&gt;Lo primero sera crear el directorio "/srv/www/iesgn" junto a su "index.html" el cual contendrá una "bienvenida" como se a comentado anteriormente.Y cambiar sus propietario a "www-data" ya que este es el usuario definido en el fichero de configuración de nginx ("/etc/nginx/nginx.conf").&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;sudo mkdir /srv/www/iesgn/&lt;/span&gt;
&lt;span class="go"&gt;sudo echo &amp;quot;Bienvenido a la página principal IES Gonzalo Nazareno&amp;quot; &amp;gt; index.html&lt;/span&gt;
&lt;span class="go"&gt;sudo chown -R www-data. /srv &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Una vez realizado lo siguiente será copiar el fichero "default" ubicado en "/etc/nginx/sites-available/" con el nombre "wwwiesgn" este fichero contendrá la siguiente información:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;server {&lt;/span&gt;
&lt;span class="go"&gt;  listen 80;&lt;/span&gt;

&lt;span class="go"&gt;  root /srv/www/iesgn;&lt;/span&gt;
&lt;span class="go"&gt;  index index.html index.htm;&lt;/span&gt;
&lt;span class="go"&gt;  server_name www.iesgn.org;&lt;/span&gt;
&lt;span class="go"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Una vez definida esta configuración, si quieres validarla puedes utilizar el comando &lt;code&gt;nginx -t&lt;/code&gt; para comprobar que no hay ningún error en el fichero, luego crea el enlace simbólico para habilitarlo y reinicia el servicio:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;nginx -t&lt;/span&gt;
&lt;span class="go"&gt;ln -s /etc/nginx/sites-available/wwwiesgn /etc/nginx/sites-enabled/&lt;/span&gt;
&lt;span class="go"&gt;sudo systemctl restart nginx&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Configuración de "departamentos.iesgn.org"&lt;/h3&gt;
&lt;p&gt;Para este sitio se van a realizar los mismos pasos, crear el directorio e "index.html" y cambiar el propietario.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;sudo mkdir /srv/www/departamentos&lt;/span&gt;
&lt;span class="go"&gt;sudo echo &amp;quot;Bienvenido a la página de los departamentos de IES Gonzalo Nazareno&amp;quot; &amp;gt; index.html&lt;/span&gt;
&lt;span class="go"&gt;sudo chown -R www-data. /srv &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Una vez realizado, vuelve a copiar el fichero "default" y nombralo "departamentosiesgn" y edita el contenido quedando de la siguiente forma:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;server {&lt;/span&gt;
&lt;span class="go"&gt;  listen 80;&lt;/span&gt;

&lt;span class="go"&gt;  root /srv/www/departamentos;&lt;/span&gt;
&lt;span class="go"&gt;  index index.html index.htm;&lt;/span&gt;

&lt;span class="go"&gt;  server_name departamentos.iesgn.org;&lt;/span&gt;
&lt;span class="go"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Una vez definida esta configuración, si quieres validarla puedes utilizar el comando &lt;code&gt;nginx -t&lt;/code&gt; para comprobar que no hay ningún error en el fichero, luego crea el enlace simbólico para habilitarlo y reinicia el servicio:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;nginx -t&lt;/span&gt;
&lt;span class="go"&gt;ln -s /etc/nginx/sites-available/departamentosiesgn /etc/nginx/sites-enabled/&lt;/span&gt;
&lt;span class="go"&gt;sudo systemctl restart nginx&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;h2&gt;Mapeo de URL&lt;/h2&gt;
&lt;h4&gt;Tarea 1&lt;/h4&gt;
&lt;p&gt;Cuando se entre a la dirección "www.iesgn.org" se redireccionará automáticamente a "www.iesgn.org/principal", donde se mostrará el mensaje de bienvenida. En el directorio principal no se permite ver la lista de los ficheros y no se permite que se siga los enlaces simbólicos.&lt;/p&gt;
&lt;p&gt;Para ello lo primero será crear el directorio "principal" y mover el index.html dentro de "principal" luego cambiar permisos:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;sudo mkdir /srv/www/iesgn/principal/&lt;/span&gt;
&lt;span class="go"&gt;sudo mv /srv/www/iesgn/index.html /srv/www/iesgn/principal&lt;/span&gt;
&lt;span class="go"&gt;sudo chown -R www-data. /srv&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Una vez realizado esto edita el fichero "wwwiesgn" agregando lo siguiente:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt; rewrite ^/$ http://www.iesgn.org/principal/index.html permanent;&lt;/span&gt;

&lt;span class="go"&gt; location /principal {&lt;/span&gt;
&lt;span class="go"&gt;    autoindex off;&lt;/span&gt;
&lt;span class="go"&gt;    disable_symlinks on;&lt;/span&gt;
&lt;span class="go"&gt; }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Una vez definida esta configuración, si quieres validarla puedes utilizar el comando &lt;code&gt;nginx -t&lt;/code&gt; para comprobar que no hay ningún error en el fichero, luego reinicia el servicio:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;sudo systemctl restart nginx&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;Tarea 2&lt;/h4&gt;
&lt;p&gt;Si accedes a la página "www.iesgn.org/principal/documentos" se visualizarán los documentos que hay en "/srv/doc". Por lo tanto se permitirá el listado de fichero y el seguimiento de enlaces simbólicos siempre que sean a ficheros o directorios cuyo dueño sea el usuario.&lt;/p&gt;
&lt;p&gt;Para ello crea el directorio "/srv/doc" con algún fichero de prueba y algún enlace simbólico y también el directorio "/srv/www/iesgn/documentos" y modifica los propietarios:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;sudo mkdir /srv/doc &amp;amp; cd /srv/doc&lt;/span&gt;
&lt;span class="go"&gt;sudo touch fich1 fich2 fich3&lt;/span&gt;
&lt;span class="go"&gt;sudo ln -s /home/debian/fichero1 fichero10&lt;/span&gt;
&lt;span class="go"&gt;sudo mkdir /srv/www/iesgn/documentos&lt;/span&gt;
&lt;span class="go"&gt;sudo chown -R www-data /srv&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Una vez realizado esto modifica la configuración de "wwwiesgn" y agrega lo siguiente:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt; location /documentos {&lt;/span&gt;
&lt;span class="go"&gt;  alias /srv/doc;&lt;/span&gt;
&lt;span class="go"&gt;  autoindex on;&lt;/span&gt;
&lt;span class="go"&gt;  default_type text/html;&lt;/span&gt;
&lt;span class="go"&gt;  disable_symlinks if_not_owner;&lt;/span&gt;
&lt;span class="go"&gt; }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Una cosa curiosa, es el paŕametro "default_type" este paŕametro es para que nginx tome por defecto el tipo de los ficheros dentro del directorio, estos tipos aparecen en el fichero "/etc/nginx/mime.types", y dependiendo del tipo nginx se comporta de una forma, es decir, los muestra, los ejecuta, los descarga, etc... Al ser ficheros vacíos y no aparecer el tipo en el fichero "mime.types" este por defecto los descarga, este no es el comportamiento que se desea, entonces se le asigna el tipo de "text/html" para que los muestre en el navegador en vez de descargarlos. Si por alguna casualidad se requiere saber el tipo "mime" de un fichero puedes realizar el siguiente comando:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;file -b --mime-type /srv/doc/fich1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Una vez definida esta configuración, si quieres validarla puedes utilizar el comando &lt;code&gt;nginx -t&lt;/code&gt; para comprobar que no hay ningún error en el fichero, luego reinicia el servicio:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;sudo systemctl restart nginx&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;Tarea 3&lt;/h4&gt;
&lt;p&gt;En todo el host virtual se debe redefinir los mensajes de error de objeto no encontrado y no permitido. Para el ello se crearán dos ficheros "html" dentro del directorio error.&lt;/p&gt;
&lt;p&gt;Lo primero es crear el directorio "/srv/www/iesgn/error" y crear los ficheros de errores y cambiar los propietarios:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;sudo mkdir /srv/www/iesgn/error&lt;/span&gt;
&lt;span class="go"&gt;sudo echo &amp;quot;&amp;lt;h1&amp;gt;OBJETO NO PERMITIDO&amp;lt;/h1&amp;gt;&amp;quot; &amp;gt; /srv/www/iesgn/error/403.html&lt;/span&gt;
&lt;span class="go"&gt;sudo echo &amp;quot;&amp;lt;h1&amp;gt;OBJETO NO ENCONTRADO&amp;lt;/h1&amp;gt;&amp;quot; &amp;gt; /srv/www/iesgn/error/404.html&lt;/span&gt;
&lt;span class="go"&gt;sudo chown -R www-data /srv&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;A continuación agrega estas líneas a "wwwiesgn":&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;error_page 403 /error/403.html;&lt;/span&gt;
&lt;span class="go"&gt;error_page 404 /error/404.html;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Una vez definida esta configuración, si quieres validarla puedes utilizar el comando &lt;code&gt;nginx -t&lt;/code&gt; para comprobar que no hay ningún error en el fichero, luego reinicia el servicio:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;sudo systemctl restart nginx&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;h2&gt;Autentificación, Autorización, y Control de Acceso&lt;/h2&gt;
&lt;h4&gt;Tarea 1&lt;/h4&gt;
&lt;p&gt;Añade al escenario otra máquina conectada por una red interna al servidor. A la URL departamentos.iesgn.org/intranet solo se debe tener acceso desde el cliente de la red local, y no se pueda acceder desde la anfitriona por la red pública. A la URL departamentos.iesgn.org/internet, sin embargo, solo se debe tener acceso desde la anfitriona por la red pública, y no desde la red local.&lt;/p&gt;
&lt;p&gt;Lo primero es crear los directorios y "index.html" de ambos, así como el cambio de propietario:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;sudo mkdir /srv/www/departamentos/intranet&lt;/span&gt;
&lt;span class="go"&gt;sudo mkdir /srv/www/departamentos/internet&lt;/span&gt;
&lt;span class="go"&gt;echo &amp;quot;&amp;lt;h1&amp;gt;Página Intranet&amp;lt;/h1&amp;gt;&amp;quot; &amp;gt; /srv/www/departamentos/intranet/index.html&lt;/span&gt;
&lt;span class="go"&gt;echo &amp;quot;&amp;lt;h1&amp;gt;Página Internet&amp;lt;/h1&amp;gt;&amp;quot; &amp;gt; /srv/www/departamentos/internet/index.html&lt;/span&gt;
&lt;span class="go"&gt;chown -R www-data. /srv&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Agrega la siguiente configuración al fichero "departamentosiesgn":&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt; location /intranet {&lt;/span&gt;
&lt;span class="go"&gt;  deny 172.23.0.0/16;&lt;/span&gt;
&lt;span class="go"&gt;  allow 10.0.0.0/24;&lt;/span&gt;
&lt;span class="go"&gt; }&lt;/span&gt;

&lt;span class="go"&gt; location /internet  {&lt;/span&gt;
&lt;span class="go"&gt;  deny 10.0.0.0/24;&lt;/span&gt;
&lt;span class="go"&gt;  allow 172.23.0.0/16;&lt;/span&gt;
&lt;span class="go"&gt; }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Una vez definida esta configuración, si quieres validarla puedes utilizar el comando &lt;code&gt;nginx -t&lt;/code&gt; para comprobar que no hay ningún error en el fichero, luego reinicia el servicio:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;sudo systemctl restart nginx&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;Tarea 2&lt;/h4&gt;
&lt;p&gt;Con autentificación básica limita el acceso a la URL "departamentos.iesgn.org/secreto".&lt;/p&gt;
&lt;p&gt;Para ello se hará uso de la herramienta "htpasswd" la cual se incluye en el paquete "apache2-utils" para instalar utiliza el siguiente comando:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;sudo apt install apache2-utils&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Una vez instalado utiliza el siguiente comando para generar el fichero con los usuarios y sus contraseñas:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;sudo htpasswd -c /etc/nginx/.htpasswd jose&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Esto pedirá la contraseña de jose y se creará el fichero, a continuación crea el directorio "/secreto" y su "index.html" así como el cambio de propietario:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;sudo mkdir /srv/www/departamentos/secreto&lt;/span&gt;
&lt;span class="go"&gt;sudo echo &amp;quot;&amp;lt;h1&amp;gt;Página Secreta&amp;lt;/h1&amp;gt;&amp;quot; &amp;gt; /srv/www/departamentos/secreto/index.html&lt;/span&gt;
&lt;span class="go"&gt;chown -R www-data. /srv&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Por último edita el fichero "departamentosiesgn" agregando el siguiente contenido:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt; location /secreto {&lt;/span&gt;
&lt;span class="go"&gt;  auth_basic &amp;quot;Area Restringida&amp;quot;;&lt;/span&gt;
&lt;span class="go"&gt;  auth_basic_user_file /etc/nginx/.htpasswd;&lt;/span&gt;
&lt;span class="go"&gt; }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Una vez definida esta configuración, si quieres validarla puedes utilizar el comando &lt;code&gt;nginx -t&lt;/code&gt; para comprobar que no hay ningún error en el fichero, luego reinicia el servicio:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;sudo systemctl restart nginx&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;Tarea 3&lt;/h4&gt;
&lt;p&gt;Se va a combinar el control de acceso y la autentificación, se va a configurar el virtual host para que se comporte de la siguiente manera: el acceso a la URL "departamentos.iesgn.org/secreto" se hace forma directa desde la intranet, desde la red pública te pide la autentificación.&lt;/p&gt;
&lt;p&gt;Para realizar esto modifica el fichero "departamentosiesgn" dejándolo así;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt; location /secreto {&lt;/span&gt;
&lt;span class="go"&gt;  satisfy any;&lt;/span&gt;
&lt;span class="go"&gt;  allow 10.0.0.0/24;&lt;/span&gt;
&lt;span class="go"&gt;  auth_basic &amp;quot;Area Restringida&amp;quot;;&lt;/span&gt;
&lt;span class="go"&gt;  auth_basic_user_file /etc/nginx/.htpasswd;&lt;/span&gt;
&lt;span class="go"&gt;  deny all;&lt;/span&gt;
&lt;span class="go"&gt; }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Una vez definida esta configuración, si quieres validarla puedes utilizar el comando &lt;code&gt;nginx -t&lt;/code&gt; para comprobar que no hay ningún error en el fichero, luego reinicia el servicio:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;sudo systemctl restart nginx&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Muchas gracias por leer hasta aquí espero que haya servido de ayuda. Un saludo.    &lt;/p&gt;</content><category term="Servicios"></category></entry><entry><title>Configuración DHCP y Tareas</title><link href="https://arpovea.vercel.app/configuracion-dhcp-y-tareas.html" rel="alternate"></link><published>2020-10-08T00:00:00+02:00</published><updated>2020-10-08T00:00:00+02:00</updated><author><name>Adrián Rodríguez Povea</name></author><id>tag:arpovea.vercel.app,2020-10-08:/configuracion-dhcp-y-tareas.html</id><summary type="html">&lt;p&gt;Buenas! En esta ocasión se va a realizar la instalación de un servidor DHCP, en un escenario creado con Vagrant, se van a realizar distintas configuraciones y pruebas.&lt;/p&gt;</summary><content type="html">&lt;hr&gt;
&lt;p&gt;Buenas! En esta ocasión se va a realizar la instalación de un servidor DHCP, en un escenario creado con Vagrant, se van a realizar distintas configuraciones y pruebas.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Un poco de Teoría&lt;/h2&gt;
&lt;p&gt;&lt;img alt="graficodhcp" src="https://arpovea.vercel.app/images/DHCP/graficodhcp.png"&gt;&lt;/p&gt;
&lt;p&gt;La anterior imagen refleja el comportamiento que tiene el cliente y el servidor en cuánto a la demanda y oferta de IPs en las distintas situaciones por las que pasan, a continuación se explicará cada una de estas fases.&lt;/p&gt;
&lt;p&gt;Cuanto se inicia el cliente esta en modo INIT, este realiza una petición (DHCPDISCOVER) al broadcast (255.255.255.255) ya que no tiene configuración IP, después de enviar esta petición el cliente pasa al estado SELECTING, donde recibe los mensajes (DHCPOFFER) de los servidores DHCP, entonces el cliente envía un mensaje (PREREQUEST) para elegir el servidor DHCP, el cual contestará con un (DHCPACK) el cual contiene una IP, el cliente en este momento comprueba que esa IP no la tenga nadie en la red, mediante un mensaje al brodcast preguntando por esa IP, si alguien contesta descarta la IP mandando al DHCP un mensaje (DHCPDECLINE) con lo cual el cliente vuelve al estado INIT, de lo contrario si nadie contesta el cliente acepta el (DHCPACK) y el servidor confirma la concesión con un (ACK) y el cliente pasa al estado BOUND.&lt;/p&gt;
&lt;p&gt;En el DHCPACK que envía el servidor se manda la siguiente información aparte de la IP:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;T1 es el temporizador de renovación de alquiler.&lt;/li&gt;
&lt;li&gt;T2 es el temporizador de reenganche.&lt;/li&gt;
&lt;li&gt;T3 es la duración del alquiler.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;El estado de RENEWING ocurre una vez que el tiempo de T1 expira, el cliente pasa a este estado, en el cual el cliente tiene que negociar la renovación del alquiler de la IP actual, si por alguna razón el servidor no renueva el alquiler le manda un mensaje (DHCPNACK) al cliente y este pasa de nuevo a fase INIT para obtener de nuevo otra dirección, en caso contrario el servidor manda un mensaje (DHCPACK) con los nuevos tiempos, y el cliente toma estos valores y se mueve al estado BOUND.&lt;/p&gt;
&lt;p&gt;El estado REBINDING ocurre una vez que el tiempo de T2 expira, en este momento el cliente comienza a enviar (DHCPREQUEST) al brodcast, asumiendo que pasado el tiempo de T2 el servidor DHCP original no esta disponible, buscando alguien que le renueve el alquiler actual, si algun otro DHCP contesta con un (DHCPACK), el cliente toma los valores y vuelve al estado BOUND, en caso de que nadie contesta el alquiler cesa y vuelve al estado INIT.&lt;/p&gt;
&lt;p&gt;Al expirar la concesión el cliente debe devolver la IP y cesar todas las acciones con dicha IP, hay que recalcar que el cliente no siempre tiene que esperar la expiración del alquiler, él, en cualquier momento, puede renunciar a una dirección IP cancelando su alquiler. Esto se realiza por ejemplo cuando un equipo de desconecta de la red antes del tiempo de expiración del alquiler, en esta situación el cliente manda un mensaje (DHCPRELEASE) al servidor DHCP para cancelar el alquiler, quedando esa IP libre.&lt;/p&gt;
&lt;p&gt;Si los clientes DHCP estan en ordenadores que tienen disco duro, la dirección IP asignada puede ser almacenada en este dispositivo y, cuando reinicie sus operaciones, puede hacer una nueva petición usando esta dirección IP.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Preparación del escenario&lt;/h2&gt;
&lt;p&gt;El escenario se va a realizar con Vagrant utilizando libvirt para la virtualización. Se van a definir dos máquinas, una donde se instalará el servidor DHCP y otra que servirá como cliente.&lt;/p&gt;
&lt;p&gt;El servidor DHCP tendrá en un principio dos interfaces de red, una pública con salida a internet y otra privada en la cual repartirá direcciones del rango &lt;code&gt;192.168.100.0/24&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Previamente se han creado las redes "lan1" y "lan2" que serán necesarias para las pruebas a realizar, esto se ha hecho con la ayuda de &lt;code&gt;virsh&lt;/code&gt; y ficheros "xml" para configurar estas redes. A continuación se muestra el contenido de estos ficheros:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;lan1:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;network&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;lan1&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;bridge&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;virbr2&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;ip&lt;/span&gt; &lt;span class="na"&gt;address=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;192.168.100.1&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;netmask=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;255.255.255.0&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/network&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;lan2:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;network&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;lan2&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;bridge&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;virbr3&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;ip&lt;/span&gt; &lt;span class="na"&gt;address=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;192.168.200.1&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;netmask=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;255.255.255.0&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/network&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Así como &lt;code&gt;br0&lt;/code&gt; en el fichero &lt;code&gt;etc/network/interfaces&lt;/code&gt; de la máquina anfitrión:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;auto br0&lt;/span&gt;
&lt;span class="go"&gt;iface br0 inet dhcp&lt;/span&gt;
&lt;span class="go"&gt;bridge_ports enp61s0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;A continuación se expone el contenido del fichero Vagrantfile:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="no"&gt;Vagrant&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;configure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;define&lt;/span&gt; &lt;span class="ss"&gt;:dhcp&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
   &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;box&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;debian/buster64&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hostname&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;dhcp&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;synced_folder&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/vagrant&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;disabled&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
   &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;network&lt;/span&gt; &lt;span class="ss"&gt;:public_network&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:dev&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;br0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:type&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;bridge&amp;#39;&lt;/span&gt;
   &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;network&lt;/span&gt; &lt;span class="ss"&gt;:private_network&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:ip&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;192.168.100.1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:libvirt__network_name&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;lan1&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;provision&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;shell&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;inline&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sudo ip r del default via 192.168.121.1 dev ens5&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;provider&lt;/span&gt; &lt;span class="ss"&gt;:libvirt&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
     &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;qemu+unix:///system&amp;#39;&lt;/span&gt;
     &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;debianserver&amp;quot;&lt;/span&gt;
     &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cpus&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
     &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;memory&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;512&lt;/span&gt;
   &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;define&lt;/span&gt; &lt;span class="ss"&gt;:clinux&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
   &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;box&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;debian/buster64&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hostname&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;clinux&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;synced_folder&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/vagrant&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;disabled&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
   &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;network&lt;/span&gt; &lt;span class="ss"&gt;:private_network&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:libvirt__network_name&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;lan1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:libvirt__dhcp_enabled&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;false&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;provision&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;shell&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;inline&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sudo ip r del default via 192.168.121.1 dev ens5&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;provider&lt;/span&gt; &lt;span class="ss"&gt;:libvirt&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
     &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;qemu+unix:///system&amp;#39;&lt;/span&gt;
     &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;debiancliente1&amp;quot;&lt;/span&gt;
     &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cpus&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
     &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;memory&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;512&lt;/span&gt;
   &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Como se puede observar en esta configuración, se borra la ruta de encaminamiento que crea vagrant por defecto, para que salga exclusivamente por la que se ha especificado.También se modifica el fichero &lt;code&gt;resolv.conf&lt;/code&gt; para indicarle el servidor DNS, esto una vez la máquina del servidor esta arrancada.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Instalación y configuración del servidor DHCP&lt;/h2&gt;
&lt;p&gt;Una vez iniciado el escenario, accede a la máquina &lt;code&gt;dhcp&lt;/code&gt; donde se instalará el servidor DHCP. Para ello:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo apt update &amp;amp;&amp;amp; sudo apt install isc-dhcp-server&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Al instalarlo el servicio fallará y mandará un mensaje de error, pero es normal ya que aún no está configurado.&lt;/p&gt;
&lt;p&gt;El primer fichero que hay que editar es &lt;code&gt;/etc/default/isc-dhcp-server&lt;/code&gt; en el cual se indica la interfaz de red donde va a trabajar el servidor DHCP. Dejandolo así:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;INTERFACESv4="ens7"&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Una vez realizado esto el fichero de configuración principal del DHCP es &lt;code&gt;/etc/dhcp/dhcpd.conf&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Edita el fichero dejando la siguiente configuración:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;ddns-update-style none;&lt;/span&gt;
&lt;span class="go"&gt;autoritative;&lt;/span&gt;

&lt;span class="go"&gt;subnet 192.168.100.0 netmask 255.255.255.0 {&lt;/span&gt;
&lt;span class="go"&gt; range 192.168.100.2 192.168.100.254;&lt;/span&gt;
&lt;span class="go"&gt; max-lease-time 43200;&lt;/span&gt;
&lt;span class="go"&gt; default-lease-time 600;&lt;/span&gt;
&lt;span class="go"&gt; option subnet-mask 255.255.255.0;&lt;/span&gt;
&lt;span class="go"&gt; option broadcast-address 192.168.100.255;&lt;/span&gt;
&lt;span class="go"&gt; option routers 192.168.100.1;&lt;/span&gt;
&lt;span class="go"&gt; option domain-name-servers 192.168.1.1;&lt;/span&gt;
&lt;span class="go"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Recalcar que se ha asignado un tiempo corto de renovación, para comprobar los cambios en el escenario en las distintas pruebas.&lt;/p&gt;
&lt;p&gt;Una vez realizado estos cambios hay que reiniciar el servidor DHCP:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo sistemctl restart isc-dhcp-server&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Con esto el servidor ya debe de repartir las direcciones en "lan1".&lt;/p&gt;
&lt;p&gt;La lista de concesiones del servidor se puede mirar en fichero &lt;code&gt;/var/lib/dhcp/dhcp.leases&lt;/code&gt; realizando por ejemplo el siguiente comando se puede observar la última concesión:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;tail /var/lib/dhcp/dhcpd.leases&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;En este caso muestra la siguiente información:&lt;/p&gt;
&lt;p&gt;&lt;img alt="ultimaconsesión" src="https://arpovea.vercel.app/images/DHCP/ultimaconcesion.png"&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Configuración en el cliente.&lt;/h2&gt;
&lt;p&gt;En el cliente modifica el fichero &lt;code&gt;/etc/network/interfaces&lt;/code&gt; dejándolo así:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;auto ens6&lt;/span&gt;
&lt;span class="go"&gt;iface ens6 inet dhcp&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Reinicia el servicio "networking" en el cliente:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo systemctl restart networking&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;También puedes solicitar una IP, realiza el siguiente comando:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo dhclient ens6&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Obteniendo la siguiente IP:&lt;/p&gt;
&lt;p&gt;&lt;img alt="ipclinux" src="https://arpovea.vercel.app/images/DHCP/ipclinux.png"&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Configuración del servidor para que los clientes realizen NAT&lt;/h2&gt;
&lt;p&gt;Para ello hay que realizar dos tareas:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Activar el bit de enrutamiento en el fichero &lt;code&gt;/etc/sysctl.conf&lt;/code&gt; Para ello:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;sudo nano /etc/sysctl.conf&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Y descomenta la siguiente línea:&lt;ul&gt;
&lt;li&gt;&lt;code&gt;net.ipv4.ip_forward=1&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Y luego:&lt;ul&gt;
&lt;li&gt;&lt;code&gt;sudo sysctl -p&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Crear la ruta de IPTABLES. Para ello:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;sudo iptables -t nat -A POSTROUTING -s 192.168.100.0/24 -o ens6 -j MASQUERADE&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;A continuación reinicia el servicio:&lt;ul&gt;
&lt;li&gt;&lt;code&gt;sudo systemctl restart networking&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Una vez realizado esto el servidor queda configurado para que el cliente pueda salir a internet realizando NAT, en las siguientes imagenes se puede comprobar las configuraciones realizadas y la navegación del cliente:&lt;/p&gt;
&lt;p&gt;&lt;img alt="iprdhcp" src="https://arpovea.vercel.app/images/DHCP/iprdhcp.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="iprclinux" src="https://arpovea.vercel.app/images/DHCP/capturaiprclinux.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="tracerouteclinux" src="https://arpovea.vercel.app/images/DHCP/capturatracrouteclinux.png"&gt;&lt;/p&gt;
&lt;p&gt;A continuación se realiza una captura de los paquetes que corresponden a una concesión utilizando el comando &lt;code&gt;tcpdum&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo tcpdump -i ens7 -pvn port 67 and port 68&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="tcpdump" src="https://arpovea.vercel.app/images/DHCP/tcpdump.png"&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Pruebas a realizar con el escenario y los clientes&lt;/h2&gt;
&lt;h4&gt;Los clientes toman una configuración, y a continuación apagamos el servidor dhcp. ¿Qué ocurre con el cliente windows? ¿Y con el cliente linux?&lt;/h4&gt;
&lt;p&gt;A continuación dejo un video en el que se explica lo ocurrido:&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.youtube.com/watch?v=5x13rKnYLYE" title=""&gt;&lt;img alt="Tarea6" src="http://img.youtube.com/vi/5x13rKnYLYE/0.jpg"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h4&gt;Los clientes toman una configuración, y a continuación cambiamos la configuración del servidor dhcp (por ejemplo el rango). ¿Qué ocurriría con un cliente windows? ¿Y con el cliente linux?&lt;/h4&gt;
&lt;p&gt;A continuación dejo un video en el que se explica lo ocurrido:&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.youtube.com/watch?v=LEzdYdzjwqg" title=""&gt;&lt;img alt="Tarea7" src="http://img.youtube.com/vi/LEzdYdzjwqg/0.jpg"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Creando reservas en el servidor DHCP&lt;/h2&gt;
&lt;p&gt;Para crear una reserva se añade la siguiente información al fichero &lt;code&gt;/etc/dhcp/dhcpd.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;host clinux {&lt;/span&gt;
&lt;span class="go"&gt;hardware ethernet 52:54:00:20:cb:8f;&lt;/span&gt;
&lt;span class="go"&gt;fixed-address 192.168.100.100;&lt;/span&gt;
&lt;span class="go"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Como se puede observar necesitaras la dirección MAC de la tarjeta del cliente.&lt;/p&gt;
&lt;p&gt;Una vez realizados los cambios se reinicia el servidor y pasado el tiempo de renovación, esta cambiará la IP.&lt;/p&gt;
&lt;p&gt;&lt;img alt="reserva" src="https://arpovea.vercel.app/images/DHCP/reserva.png"&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Configurar varios ambitos&lt;/h2&gt;
&lt;p&gt;Para esto hay que modificar el "Vagrantfile" del escenario y agregar nuevas conexiones quedando así:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="no"&gt;Vagrant&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;configure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;define&lt;/span&gt; &lt;span class="ss"&gt;:dhcp&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
   &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;box&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;debian/buster64&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hostname&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;dhcp&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;synced_folder&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/vagrant&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;disabled&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
   &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;network&lt;/span&gt; &lt;span class="ss"&gt;:public_network&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:dev&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;br0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:type&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;bridge&amp;#39;&lt;/span&gt;
   &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;network&lt;/span&gt; &lt;span class="ss"&gt;:private_network&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:ip&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;192.168.100.1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:libvirt__network_name&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;lan1&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;network&lt;/span&gt; &lt;span class="ss"&gt;:private_network&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:ip&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;192.168.200.1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:libvirt__network_name&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;lan2&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;provision&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;shell&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;inline&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sudo ip r del default via 192.168.121.1 dev ens5&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;provider&lt;/span&gt; &lt;span class="ss"&gt;:libvirt&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
     &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;qemu+unix:///system&amp;#39;&lt;/span&gt;
     &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;debianserver&amp;quot;&lt;/span&gt;
     &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cpus&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
     &lt;span class="n"&gt;dhcp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;memory&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;512&lt;/span&gt;
   &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;define&lt;/span&gt; &lt;span class="ss"&gt;:clinux&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
   &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;box&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;debian/buster64&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hostname&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;clinux&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;synced_folder&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/vagrant&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;disabled&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
   &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;network&lt;/span&gt; &lt;span class="ss"&gt;:private_network&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:libvirt__network_name&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;lan1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:libvirt__dhcp_enabled&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;false&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;provision&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;shell&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;inline&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sudo ip r del default via 192.168.121.1 dev ens5&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;provider&lt;/span&gt; &lt;span class="ss"&gt;:libvirt&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
     &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;qemu+unix:///system&amp;#39;&lt;/span&gt;
     &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;debiancliente1&amp;quot;&lt;/span&gt;
     &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cpus&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
     &lt;span class="n"&gt;clinux&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;memory&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;512&lt;/span&gt;
   &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;define&lt;/span&gt; &lt;span class="ss"&gt;:clinux2&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;clinux2&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
   &lt;span class="n"&gt;clinux2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;box&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;debian/buster64&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;clinux2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hostname&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;clinux2&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;clinux2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;synced_folder&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/vagrant&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;disabled&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
   &lt;span class="n"&gt;clinux2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;network&lt;/span&gt; &lt;span class="ss"&gt;:private_network&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:libvirt__network_name&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;lan2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;:libvirt__dhcp_enabled&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;false&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;clinux2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;provision&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;shell&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
   &lt;span class="ss"&gt;inline&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sudo ip r del default via 192.168.121.1 dev ens5&amp;quot;&lt;/span&gt;
   &lt;span class="n"&gt;clinux2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;provider&lt;/span&gt; &lt;span class="ss"&gt;:libvirt&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;clinux2&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
     &lt;span class="n"&gt;clinux2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;qemu+unix:///system&amp;#39;&lt;/span&gt;
     &lt;span class="n"&gt;clinux2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;debiancliente2&amp;quot;&lt;/span&gt;
     &lt;span class="n"&gt;clinux2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cpus&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
     &lt;span class="n"&gt;clinux2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;memory&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;512&lt;/span&gt;
   &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;En el servidor hay que agregar la nueva interfaz por la cual se va a repartir direcciones editando de nuevo el fichero &lt;code&gt;/etc/default/isc-dhcp-server&lt;/code&gt;, quedando así:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;INTERFACESv4="ens7 ens8"&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;A continuación agregar el nuevo ámbito en el fichero &lt;code&gt;/etc/dhcp/dhcpd.conf&lt;/code&gt;, quedando así:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;ddns-update-style none;&lt;/span&gt;
&lt;span class="go"&gt;autoritative;&lt;/span&gt;

&lt;span class="go"&gt;subnet 192.168.100.0 netmask 255.255.255.0 {&lt;/span&gt;
&lt;span class="go"&gt; range 192.168.100.2 192.168.100.254;&lt;/span&gt;
&lt;span class="go"&gt; max-lease-time 43200;&lt;/span&gt;
&lt;span class="go"&gt; default-lease-time 600;&lt;/span&gt;
&lt;span class="go"&gt; option subnet-mask 255.255.255.0;&lt;/span&gt;
&lt;span class="go"&gt; option broadcast-address 192.168.100.255;&lt;/span&gt;
&lt;span class="go"&gt; option routers 192.168.100.1;&lt;/span&gt;
&lt;span class="go"&gt; option domain-name-servers 192.168.1.1;&lt;/span&gt;
&lt;span class="go"&gt;}&lt;/span&gt;

&lt;span class="go"&gt;host clinux {&lt;/span&gt;
&lt;span class="go"&gt;hardware ethernet 52:54:00:20:cb:8f;&lt;/span&gt;
&lt;span class="go"&gt;fixed-address 192.168.100.100;&lt;/span&gt;
&lt;span class="go"&gt;}&lt;/span&gt;

&lt;span class="go"&gt;subnet 192.168.200.0 netmask 255.255.255.0 {&lt;/span&gt;
&lt;span class="go"&gt; range 192.168.200.2 192.168.200.254;&lt;/span&gt;
&lt;span class="go"&gt; max-lease-time 43200;&lt;/span&gt;
&lt;span class="go"&gt; default-lease-time 600;&lt;/span&gt;
&lt;span class="go"&gt; option subnet-mask 255.255.255.0;&lt;/span&gt;
&lt;span class="go"&gt; option broadcast-address 192.168.200.255;&lt;/span&gt;
&lt;span class="go"&gt; option routers 192.168.200.1;&lt;/span&gt;
&lt;span class="go"&gt; option domain-name-servers 192.168.1.1;&lt;/span&gt;
&lt;span class="go"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Reinicia el servicio con:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;systemctl restart isc-server-dhcp&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Agregar la ruta a IPTABLES para la nueva red:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo iptables -t nat -A POSTROUTING -s 192.168.200.0/24 -o ens6 -j MASQUERADE&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;En el nuevo cliente "clinux2" cambiar el fichero &lt;code&gt;/etc/network/interfaces&lt;/code&gt;, quedando así&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;auto ens6&lt;/span&gt;
&lt;span class="go"&gt;iface ens6 inet dhcp&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Reinicia el servicio "networking" en el cliente:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo systemctl restart networking&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;A continuación se muestran unas capturas de ambos clientes saliendo a internet:&lt;/p&gt;
&lt;p&gt;&lt;img alt="traceroute2clinux" src="https://arpovea.vercel.app/images/DHCP/traceroute2clinux.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="traceroute2clinux2" src="https://arpovea.vercel.app/images/DHCP/traceroute2clinux2.png"&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Muchas gracias por leer hasta aquí espero que haya servido de ayuda. Un saludo.    &lt;/p&gt;</content><category term="Servicios"></category></entry></feed>